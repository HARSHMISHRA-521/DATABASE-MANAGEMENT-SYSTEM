
CREATE TABLE SALESMAN (
SALESMAN_ID INT PRIMARY KEY,
NAME VARCHAR (30),
CITY VARCHAR (10),
COMMISSION VARCHAR (10)
);

CREATE TABLE CUSTOMER (
CUSTOMER_ID INT PRIMARY KEY,
CUSTOMER_NAME VARCHAR (30),
CITY VARCHAR (10),
GRADE VARCHAR (3),
SALESMAN_ID INT,
FOREIGN KEY (SALESMAN_ID) REFERENCES SALESMAN (SALESMAN_ID) ON DELETE CASCADE
);

CREATE TABLE ORDERS (
ORDER_NO INT PRIMARY KEY,
PURCHASE_AMT INT ,
ORDER_DATE DATE,
CUSTOMER_ID INT,
SALESMAN_ID INT,
FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID) ON DELETE CASCADE,
FOREIGN KEY (SALESMAN_ID) REFERENCES SALESMAN (SALESMAN_ID) ON DELETE CASCADE
);



INSERT INTO SALESMAN VALUES (1000, 'JOHN','BANGALORE','25 %');

INSERT INTO SALESMAN VALUES (2000, 'RAVI','BANGALORE','20 %');

INSERT INTO SALESMAN VALUES (3000, 'KUMAR','MYSORE','15 %');

INSERT INTO SALESMAN VALUES (4000, 'SMITH','DELHI','30 %');

INSERT INTO SALESMAN VALUES (5000, 'HARSHA','HYDRABAD','15 %');


INSERT INTO CUSTOMER VALUES (10, 'PREETHI','BANGALORE', 100, 1000);

INSERT INTO CUSTOMER VALUES (11, 'VIVEK','MANGALORE', 300, 1000);

INSERT INTO CUSTOMER VALUES (12, 'BHASKAR','CHENNAI', 400, 2000);

INSERT INTO CUSTOMER VALUES (13, 'CHETHAN','BANGALORE', 200, 2000);

INSERT INTO CUSTOMER VALUES (14, 'MAMATHA','BANGALORE', 400, 3000);


INSERT INTO ORDERS VALUES (50, 5000, '04-05-17', 10, 1000);

INSERT INTO ORDERS VALUES (51, 450, '20-01-17', 10, 2000);

INSERT INTO ORDERS VALUES (52, 1000, '24-02-17', 13, 2000);

INSERT INTO ORDERS VALUES (53, 3500, '13-04-17', 14, 3000);

INSERT INTO ORDERS VALUES (54, 550, '09-03-17', 12, 2000);


#1
SELECT C.GRADE,COUNT(GRADE)
FROM CUSTOMER C
GROUP BY GRADE
HAVING C.GRADE >(SELECT AVG(GRADE) FROM CUSTOMER C WHERE C.CITY='BANGALORE');

#2
SELECT SALESMAN_ID,NAME
FROM SALESMAN A
WHERE 1<(
SELECT COUNT(*)
FROM CUSTOMER
WHERE SALESMAN_ID=A.SALESMAN_ID
);
# SELECT SALESMAN_ID,NAME FROM SALESMAN WHERE SALESMAN_ID IN(SELECT SALESMAN_ID FROM CUSTOMER GROUP BY SALESMAN_ID);

#3
SELECT S.SALESMAN_ID,NAME,CUSTOMER_NAME,COMMISSION
FROM SALESMAN S,CUSTOMER C
WHERE S.CITY=C.CITY
UNION
SELECT S.SALESMAN_ID,NAME, 'NOMATCH' ,COMMISSION
FROM SALESMAN S,CUSTOMER C
WHERE NOT S.CITY = ANY (SELECT CITY FROM CUSTOMER);

#4
CREATE VIEW V01 AS
(
SELECT B.ORDER_DATE,A.SALESMAN_ID,A.NAME
FROM SALESMAN A,ORDERS B
WHERE A.SALESMAN_ID=B.SALESMAN_ID
AND B.PURCHASE_AMT=(
	SELECT MAX(PURCHASE_AMT)
	FROM ORDERS C
	WHERE C.ORDER_DATE=B.ORDER_DATE
)
);

#5
DELETE FROM SALESMAN WHERE SALESMAN_ID=1000;